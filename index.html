<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Distribui√ß√£o de Projetos e avaliadroeses</title>

  <!-- jsPDF e depois o plugin AutoTable (ordem importante) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
    }
    .header-logos {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 20px;
      background-color: #f5f5f5;
      border-bottom: 1px solid #ccc;
    }
    .header-logos img {
      max-height: 80px;
      /* para n√£o exceder o espa√ßo do header */
      width: auto;
    }
    .header-logos .logo-esquerda {
      /* se quiser, alguma margem ou estilo extra */
    }
    .header-logos .logo-direita {
      /* qualquer ajuste espec√≠fico para o segundo logo */
    }
    @media (max-width: 600px) {
      .header-logos {
        flex-direction: column;
        gap: 10px;
      }
      .header-logos img {
        max-height: 60px;
      }
    }
    body { font-family: Arial, sans-serif; margin: 40px auto; max-width: 900px; background: #f9f9f9; color: #333; }
    h1 { text-align: center; color: #444; }
    label { font-weight: bold; display: block; margin-top: 15px; }
    textarea, input { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; box-sizing: border-box; }
    button { margin-top: 12px; padding: 10px 15px; font-size: 15px; border: none; border-radius: 6px; cursor: pointer; background: #4CAF50; color: white; }
    button:hover { background: #45a049; }
    table { margin-top: 16px; width: 100%; border-collapse: collapse; background: white; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; vertical-align: top; }
    th { background: #eee; }
    .actions { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
  </style>
</head>
<body>
  <header class="header-logos">
    <div class="logo-esquerda">
      <img src="https://www.registro.unesp.br/Home/sobreocampus/administracao/brasao_fcavr.jpg"
           alt="Bras√£o FCAVR" />
    </div>
    <div class="logo-direita">
      <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQHsOIBzoAF-ftLo097TIhqFOnxeXth-fPl5g&s"
           alt="Logo 2" />
    </div>
  </header>
  
  <h1>Distribui√ß√£o de Projetos e avaliadroeses CIC v8</h1>

  <label for="salas">Quantidade de salas:</label>
  <input type="number" id="salas" min="1" value="2">

  <label for="grupos">Digite os grupos (um por linha):</label>
  <textarea id="grupos" rows="6"></textarea>

  <label for="avaliadroeses">Digite os avaliadroeses (um por linha):</label>
  <textarea id="avaliadroeses" rows="6"></textarea>

  <label for="jsonFile">Ou carregue um arquivo JSON (com propriedades "trabalhos" e "avaliadroeses"):</label>
  <input type="file" id="jsonFile" accept=".json">

  <div class="actions">
    <button onclick="gerarDistribuicao()">Gerar Distribui√ß√£o</button>
    <button onclick="exportarCSV()">Exportar CSV</button>
    <button onclick="exportarPDF()">Exportar PDF</button>
    <button onclick="carregarBase()">BASE DE DADOS 2025</button>
  </div>

  <div id="resultado"></div>

  <script>
    const base2025Grupos = [
  {
    "grupos": "POTENCIAL DO VALE DO RIBEIRA PARA CAF√âS ESPECIAIS: A VALIA√á√ÉO DE CULTIV ARES DE COFFEA ARABICA",
    "orientador": "Alex Mendon√ßa de Carvalho"
  },
  {
    "grupos": "QUALIDADE DE BEBIDA DE CLONES DE COFFEA CANEPHORA EM CONDI√á√ïES DE AMBIENTE SUBTROPICAL √öMIDO, VALE DO RIBEIRA-SP, BRASIL",
    "orientador": "Alex Mendon√ßa de Carvalho"
  },
  {
    "grupos": "‚ÄúPORTA-ENXERTOS ESPEC√çFICOS PARA CULTIVARES DE CAF√â AR√ÅBICA EM √ÅREA ISENTA DE INFESTA√á√ÉO POR NEMATOIDES‚Äù",
    "orientador": "Alex Mendon√ßa de Carvalho"
  },
  {
    "grupos": "‚ÄúPERFORMANCE PRODUTIVA DE CLONES DE COFFEA CANEPHORA\"",
    "orientador": "Alex Mendon√ßa de Carvalho"
  },
  {
    "grupos": "BIOMARCADORES COMPORTAMENTAIS DE NEUROTOXICIDADE EM LARVAS DE ZEBRAFISH (Danio rerio) EXPOSTAS AO HERBICIDA ROUNDUP¬Æ TRANSORB",
    "orientador": "Ana Let√≠cia Madeira Sanches"
  },
  {
    "grupos": "AVALIA√á√ÉO DE HOMOGENEIDADE DE √ÅREA COM PRODU√á√ÉO DE MILHO VERDE",
    "orientador": "Elza Alves Correa"
  },
  {
    "grupos": "DIN√ÇMICA DE LIXIVIA√á√ÉO DE HERBICIDAS PR√â - EMERGENTES",
    "orientador": "Elza Alves Correa"
  },
  {
    "grupos": "TAXA DE CRESCIMENTO DE BANANEIRAS EM RESPOSTA AO EFEITO DE HORMESE",
    "orientador": "Elza Alves Correa"
  },
  {
    "grupos": "PARAMETRIZA√á√ÉO DO MODELO CROPGRO-PERENNIAL FORAGE PARA ESTIMATIVA DA MASSA DE FORRAGEM DO CAPIM-IPYPOR√É",
    "orientador": "Fagner Junior Gomes"
  },
  {
    "grupos": "ASSIMILA√á√ÉO DE CO2 E SATURA√á√ÉO DE LUZ DO CAPIM-IPYPOR√É AFETADO PELA FIXA√á√ÉO N√ÉO SIMBI√ìTICA DE NITROG√äNIO",
    "orientador": "Fagner Junior Gomes"
  },
  {
    "grupos": "Influ√™ncia da fertilidade do solo na fitossociologia e estoques de carbono em √°reas de mata atl√¢ntica em processo de restaura√ß√£o ecol√≥gica",
    "orientador": "Francisca Alcivania de Melo Silva"
  },
  {
    "grupos": "SUBSTRATO PARA A PRODU√á√ÉO DE MUDAS FLORESTAISCOM RES√çDUOS DA AGROIND√öSTRIA DA POLPA DE JU√áARA",
    "orientador": "Francisca Alcivania de Melo Silva"
  },
  {
    "grupos": "AFERI√á√ÉO DE PONTAS DE PULVERIZA√á√ÉO ACIONADAS POR UM PULVERIZADOR COSTAL MANUAL",
    "orientador": "Gl√°ucia Maria Pereira Pavarini"
  },
  {
    "grupos": "CALIBRA√á√ÉO DA TEMPERATURA E UMIDADE DO AR DE SISTEMA IoT APLICADO AO MONITORAMENTO AMBIENTAL DO ‚ÄúCHILLING‚Äù DA BANANA",
    "orientador": "Juliana Domingues Lima"
  },
  {
    "grupos": "Efeito do tratamento do cacho da bananeira com a auxina 2,4-D e Zinco no inverno",
    "orientador": "Juliana Domingues Lima"
  },
  {
    "grupos": "APLICA√á√ÉO VIA CACHO DE FERTILIZANTES COM BIOESTIMULANTES NA CULTURA DA BANANA NO INVERNO/PRIMAVERA",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "ADUBA√á√ÉO BASEADA NO √çNDICE DE SUFICI√äNCIA DE NITROG√äNIO INFLUENCIANDO A PRODUTIVIDADE E A QUALIDADE DE FRUTOS DA BANANEIRA GRAND NAINE",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "ATRIBUTOS QU√çMICOS DO SOLO EM BANANAL ADUBADO DE ACORDO COM O √çNDICE DE SUFICI√äNCIA DE NITROG√äNIO (SEGUNDO CICLO)",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "TECNOLOGIAS AUXILIARES DA ADUBA√á√ÉO NA PRODU√á√ÉO E QUALIDADE DE FRUTOS DA CULTIVAR VTP HAYASHI ‚Äì PRIMEIRO CICLO",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "A ADUBA√á√ÉO NITROGENADA UTILIZADA NO BANANAL PODE AFETAR A COMPACTA√á√ÉO DO SOLO?",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "DE RES√çDUO A ALIADO: HIDROLATO √Ä BASE DE Cupressus sp. NO CONTROLE DO FITOPATOGENO Colletotrichum fructicola",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "PRODUTIVIDADE DA CULTURA DA BANANA NO PRIMEIRO CICLO, AP√ìS O MANEJO DA APLICA√á√ÉO DE NITROG√äNIO, TENDO COMO BASE A MEDIDA INDIRETA DE CLOROFILA",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "AUTOMATIZA√á√ÉO DA RECOMENDA√á√ÉO DE CALAGEM BASEADA EM DIFERENTES TIPOS DE CALC√ÅRIO USANDO PYTHON E GOOGLE SHEETS",
    "orientador": "Leandro Jose Grava de Godoy"
  },
  {
    "grupos": "BAIXAS CONCENTRA√á√ïES DO EXTRATO METAN√ìLICO DE Osmundaria obtusiloba INIBEM A CONIDIA√á√ÉO SECUND√ÅRIA in vitro DO FUNGO Colletotrichum abscissum, AGENTE CAUSAL DA PODRID√ÉO FLORAL DOS CITROS",
    "orientador": "Maria Candida de Godoy Gasparoto"
  },
  {
    "grupos": "HIDROLATO DE EUCALIPTO CITRIODORA, ASSOCIADO OU N√ÉO A BIOFILME DE AMIDO DE MILHO, NO CONTROLE DA ANTRACNOSE DO MAMOEIRO",
    "orientador": "Maria Candida de Godoy Gasparoto"
  },
  {
    "grupos": "PER√çODO DE INCUBA√á√ÉO DA ANTRACNOSE (Colletotrichum fructicola) EM FRUTOS DE MAM√ÉO (Carica papaya) TRATADOS NA P√ìS-COLHEITA COM HIDROLATO DE EUCALIPTO CITRIODORA (Corymbia citriodora)",
    "orientador": "Maria Candida de Godoy Gasparoto"
  },
  {
    "grupos": "ESTABILIDADE E ATIVIDADE FUNGIT√ìXICA DE HIDROLATOS NO CONTROLE in vitro DO FITOPAT√ìGENO Colletotrichum fructicola",
    "orientador": "Maria Candida de Godoy Gasparoto"
  },
  {
    "grupos": "‚ÄúFenotipagem em larga escala por an√°lise de imagens RGB em gen√≥tipos de batata-doce‚Äù",
    "orientador": "Pablo Forlan Vargas"
  },
  {
    "grupos": "EFEITO DO COBRE NA ESTABILIDADE E AGREGA√á√ÉO DA HEMOGLOBINA EXTRACELULAR DE Amynthas gracilis (HbAg)",
    "orientador": "Patricia Soares Santiago"
  },
  {
    "grupos": "Estoques de C e N e sua Rela√ß√£o com a Resist√™ncia do Solo √† Ruptura, em Terras Pretas de √çndio da Amaz√¥nia Central",
    "orientador": "Reginaldo Barboza da Silva"
  },
  {
    "grupos": "ESTOQUE DE CARBONO E ESTABILIDADE ESTRUTURAL DO SOLO EM √ÅREAS AMBIENTALMENTE VULNER√ÅVEIS DA BACIA DO RIO RIBEIRA DE IGUAPE",
    "orientador": "Reginaldo Barboza da Silva"
  },
  {
    "grupos": "EFEITO DO EXTRATO AQUOSO DE CROTAL√ÅRIA(Crotal√°ria ochroleuca) SOBRE Sitophilus zeamais(COLEOPTERA:CURCULIONIDAE)",
    "orientador": "Ronaldo Pavarini"
  },
  {
    "grupos": "APRENDIZAGEM DE T√âCNICAS LABORATORIAIS EM ENTOMOLOGIA AGR√çCOLA: CRIA√á√ÉO DE LAGARTA-DAS-FOLHAS (Spodoptera eridania) EM LABORAT√ìRIO",
    "orientador": "Ronaldo Pavarini"
  }
];

 const base2025avaliadroeses = [
  { "avaliadroes": "Alex Mendon√ßa de Carvalho" },
  { "avaliadroes": "Andressa Rubim Lopes" },
  { "avaliadroes": "Rodolfo Osni" },
  { "avaliadroes": "Caetano Afonso Lanzoni Troiani" },
  { "avaliadroes": "Danilo Eduardo Rozane" },
  { "avaliadroes": "Eduardo Ant√¥nio Sanches" },
  { "avaliadroes": "Eduardo Nardini Gomes" },
  { "avaliadroes": "√ârico Tadao Teramoto" },
  { "avaliadroes": "Erik de Lima Andrade" },
  { "avaliadroes": "Fagner Junior Gomes" },
  { "avaliadroes": "Felippe Alexandre Lisboa de Miranda Daros" },
  { "avaliadroes": "Francisca Alcivania de Melo Silva" },
  { "avaliadroes": "Giovana Bertini" },
  { "avaliadroes": "Gl√°ucia Maria Pereira Pavarini" },
  { "avaliadroes": "Guilherme Wolff Bueno" },
  { "avaliadroes": "Joao Vicente Coffani Nunes" },
  { "avaliadroes": "Juliana Domingues Lima" },
  { "avaliadroes": "Kelly Botigeli Sevegnani" },
  { "avaliadroes": "Leandro Jose Grava de Godoy" },
  { "avaliadroes": "Lilian Cristina Makino" },
  { "avaliadroes": "Lu√≠s Carlos Ferreira de Almeida" },
  { "avaliadroes": "Marcelo Vieira Ferraz" },
  { "avaliadroes": "Mar√≠lia Cunha Lignon" },
  { "avaliadroes": "Patricia Gleydes Morgante" },
  { "avaliadroes": "Ronaldo Pavarini" },
  { "avaliadroes": "Santiago Montealegre Quijano" },
  { "avaliadroes": "Wilson Jose Oliveira de Souza" }
];




    // preenche textareas com base
    function carregarBase() {
      const gruposText = base2025Grupos.map(item => item.grupos).filter(Boolean).join("\n");
      const avaliadroesesText = base2025avaliadroeses.map(item => item.avaliadroes).filter(Boolean).join("\n");
      document.getElementById("grupos").value = gruposText;
      document.getElementById("avaliadroeses").value = avaliadroesesText;
    }

    // vari√°veis globais (podem ser preenchidas por JSON carregado)
    let trabalhosFromJson = [];
    let avaliadroesesFromJson = [];
    let distribuicao = [];

    // carregar JSON (opcional) ‚Äî o JSON deve ter { "trabalhos": [...], "avaliadroeses": [...] }
    document.getElementById('jsonFile').addEventListener('change', function(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          trabalhosFromJson = data.trabalhos || [];
          avaliadroesesFromJson = data.avaliadroeses || [];
          // tamb√©m preenche os textareas para visualiza√ß√£o
          if (trabalhosFromJson.length) document.getElementById('grupos').value = trabalhosFromJson.join("\n");
          if (avaliadroesesFromJson.length) document.getElementById('avaliadroeses').value = avaliadroesesFromJson.join("\n");
          alert("JSON carregado com sucesso!");
        } catch (err) {
          alert("Erro ao ler JSON: " + err.message);
        }
      };
      reader.readAsText(file);
    });

    // shuffle Fisher-Yates
    function shuffleArray(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // gera e mostra distribui√ß√£o (l√™ textareas ou usa JSON carregado)
    function gerarDistribuicao() {
  const numSalas = parseInt(document.getElementById('salas').value, 10);
  if (!numSalas || numSalas < 1) {
    alert("Digite um n√∫mero v√°lido de salas.");
    return;
  }

  const gruposText = document.getElementById('grupos').value.trim();
  const avaliadroesesText = document.getElementById('avaliadroeses').value.trim();

  const trabalhos = gruposText
    ? gruposText.split("\n").map(s => s.trim()).filter(Boolean)
    : (trabalhosFromJson.length ? trabalhosFromJson.slice() : []);

  const avaliadroeses = avaliadroesesText
    ? avaliadroesesText.split("\n").map(s => s.trim()).filter(Boolean)
    : (avaliadroesesFromJson.length ? avaliadroesesFromJson.slice() : []);

  // inicializa distribui√ß√£o
  distribuicao = Array.from({ length: numSalas }, () => ({ trabalhos: [], avaliadroeses: [] }));

  // üîπ Sala 1 sempre com PIBC1
  distribuicao[0].trabalhos.push("PIBC1");

  // embaralhar os outros trabalhos, excluindo PIBC1 caso j√° esteja na lista
  const restantes = trabalhos.filter(t => t !== "PIBC1");
  const shuffledTrabalhos = shuffleArray(restantes);
  const shuffledavaliadroeses = shuffleArray(avaliadroeses);

  // distribuir os trabalhos a partir da sala 2
  shuffledTrabalhos.forEach((t, i) => {
    const salaIndex = (i % (numSalas - 1)) + 1; // come√ßa da sala 2
    distribuicao[salaIndex].trabalhos.push(t);
  });

  // distribuir avaliadroeses (3 por sala, sem conflito com orientador)
  let salaIndex = 0;
  shuffledavaliadroeses.forEach(avaliadroes => {
    let tentativas = 0;
    while (tentativas < numSalas) {
      const sala = distribuicao[salaIndex];

      // pega orientadores dessa sala
      const orientadoresNaSala = base2025Grupos
        .filter(g => sala.trabalhos.includes(g.grupos))
        .map(g => g.orientador);

      if (
        sala.avaliadroeses.length < 3 &&
        !orientadoresNaSala.includes(avaliadroes)
      ) {
        sala.avaliadroeses.push(avaliadroes);
        break;
      }

      salaIndex = (salaIndex + 1) % numSalas;
      tentativas++;
    }
  });

  mostrarResultadoNaTela();
}


    // mostra resultado como tabelas HTML (cada item em sua linha)
    function mostrarResultadoNaTela() {
      const div = document.getElementById('resultado');
      if (!distribuicao.length) {
        div.innerHTML = "<p>Nenhuma distribui√ß√£o gerada.</p>";
        return;
      }
      let html = "";
      distribuicao.forEach((sala, i) => {
        html += `<h3>Sala ${i + 1}</h3>`;
        html += `<table><thead><tr><th>Tipo</th><th>Nome</th></tr></thead><tbody>`;
        if (sala.trabalhos.length === 0 && sala.avaliadroeses.length === 0) {
          html += `<tr><td colspan="2"><em>Sem itens</em></td></tr>`;
        } else {
          sala.trabalhos.forEach(t => { html += `<tr><td>Trabalho</td><td>${escapeHtml(t)}</td></tr>`; });
          sala.avaliadroeses.forEach(a => { html += `<tr><td>avaliadroes</td><td>${escapeHtml(a)}</td></tr>`; });
        }
        html += `</tbody></table>`;
      });
      div.innerHTML = html;
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.appendChild(document.createTextNode(text));
      return div.innerHTML;
    }

    // export CSV (cada item em linha)
    function exportarCSV() {
      if (!distribuicao.length) {
        alert("Gere a distribui√ß√£o antes de exportar.");
        return;
      }
      let csv = "Sala,Tipo,Nome\n";
      distribuicao.forEach((sala, i) => {
        sala.trabalhos.forEach(t => csv += `"Sala ${i+1}","Trabalho","${t.replace(/"/g,'""')}"\n`);
        sala.avaliadroeses.forEach(a => csv += `"Sala ${i+1}","avaliadroes","${a.replace(/"/g,'""')}"\n`);
      });
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "distribuicao.csv";
      link.click();
    }

    // export PDF usando jsPDF + autotable
    function exportarPDF() {
      if (!distribuicao.length) {
        alert("Gere a distribui√ß√£o antes de exportar.");
        return;
      }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');
      const pageWidth = doc.internal.pageSize.getWidth();
      const margin = 40;
      const col0 = 90;
      const col1 = pageWidth - margin * 2 - col0;

      distribuicao.forEach((sala, i) => {
        if (i > 0) doc.addPage();
        // t√≠tulo
        doc.setFontSize(14);
        doc.text(`Sala ${i + 1}`, margin, 40);

        // montar linhas: cada trabalho/avaliadroes uma linha
        const rows = [];
        sala.trabalhos.forEach(t => rows.push(["Trabalho", t]));
        sala.avaliadroeses.forEach(a => rows.push(["avaliadroes", a]));
        if (rows.length === 0) rows.push(["", "Sem itens"]);

        doc.autoTable({
          startY: 60,
          head: [["Tipo", "Nome"]],
          body: rows,
          theme: "grid",
          styles: { fontSize: 10, cellPadding: 6, overflow: 'linebreak' },
          columnStyles: {
            0: { cellWidth: col0 },
            1: { cellWidth: col1 }
          },
          margin: { left: margin, right: margin }
        });
      });

      doc.save("distribuicao.pdf");
    }
  </script>
</body>
</html>
